<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç·Šæ€¥ã‚¢ã‚¯ã‚»ã‚¹ - é‡å¿ƒã‚±ã‚¢ã‚¢ãƒ—ãƒª</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
            background: #f0f8ff;
        }
        .emergency {
            background: #ff6b6b;
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            font-size: 24px;
            font-weight: bold;
        }
        .qr-container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin: 20px auto;
            max-width: 400px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .url-box {
            background: #e8f4fd;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-family: monospace;
            font-size: 18px;
            word-break: break-all;
        }
        .instructions {
            background: #fffacd;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: left;
        }
        canvas {
            border: 2px solid #ddd;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <div class="emergency">
        ğŸš¨ ç·Šæ€¥ã‚¢ã‚¯ã‚»ã‚¹ç”¨QRã‚³ãƒ¼ãƒ‰ ğŸš¨
    </div>

    <div class="qr-container">
        <h2>ğŸ“± æºå¸¯ã§ã‚¹ã‚­ãƒ£ãƒ³ã—ã¦ãã ã•ã„</h2>
        <canvas id="qrcode" width="256" height="256"></canvas>
        
        <div class="url-box" id="currentUrl">
            http://192.168.2.7:3003
        </div>
        
        <p><strong>QRã‚³ãƒ¼ãƒ‰ãŒè¡¨ç¤ºã•ã‚Œãªã„å ´åˆã¯ã€ä¸Šè¨˜URLã‚’ç›´æ¥å…¥åŠ›ã—ã¦ãã ã•ã„</strong></p>
    </div>

    <div class="instructions">
        <h3>ğŸ“‹ ã‚¢ã‚¯ã‚»ã‚¹æ‰‹é †</h3>
        <ol>
            <li><strong>QRã‚³ãƒ¼ãƒ‰ã‚’ã‚¹ã‚­ãƒ£ãƒ³</strong> ã¾ãŸã¯ URLã‚’æºå¸¯ã®ãƒ–ãƒ©ã‚¦ã‚¶ã«å…¥åŠ›</li>
            <li><strong>åŒã˜Wi-Fi</strong>ã«æ¥ç¶šã•ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™</li>
            <li>ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„å ´åˆã¯ä¸‹è¨˜ã‚’ç¢ºèªï¼š
                <ul>
                    <li>PCã¨ã‚¹ãƒãƒ›ãŒåŒã˜Wi-Fiã«æ¥ç¶šã•ã‚Œã¦ã„ã‚‹ã‹</li>
                    <li>Windowsãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ã®è¨­å®š</li>
                    <li>PCã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ãŒå¤‰ã‚ã£ã¦ã„ãªã„ã‹</li>
                </ul>
            </li>
        </ol>
    </div>

    <script>
        // å¤–éƒ¨QRã‚³ãƒ¼ãƒ‰ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨
        function generateQRWithLibrary(text, canvasId) {
            const script = document.createElement('script');
            script.src = 'https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js';
            script.onload = function() {
                const canvas = document.getElementById(canvasId);
                QRCode.toCanvas(canvas, text, {
                    width: 256,
                    margin: 2,
                    color: {
                        dark: '#000000',
                        light: '#FFFFFF'
                    }
                }, function (error) {
                    if (error) {
                        console.error('QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error);
                        // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤º
                        fallbackQR(text, canvasId);
                    }
                });
            };
            script.onerror = function() {
                // ãƒ©ã‚¤ãƒ–ãƒ©ãƒªèª­ã¿è¾¼ã¿å¤±æ•—æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
                fallbackQR(text, canvasId);
            };
            document.head.appendChild(script);
        }

        // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”¨ã‚·ãƒ³ãƒ—ãƒ«QRã‚³ãƒ¼ãƒ‰
        function fallbackQR(text, canvasId) {
            const canvas = document.getElementById(canvasId);
            const ctx = canvas.getContext('2d');
            const size = canvas.width;
            
            // èƒŒæ™¯ã‚’ç™½ã§å¡—ã‚Šã¤ã¶ã—
            ctx.fillStyle = '#FFFFFF';
            ctx.fillRect(0, 0, size, size);
            
            // é»’æ ã‚’æç”»
            ctx.fillStyle = '#000000';
            ctx.fillRect(0, 0, size, 20);
            ctx.fillRect(0, size-20, size, 20);
            ctx.fillRect(0, 0, 20, size);
            ctx.fillRect(size-20, 0, 20, size);
            
            // ãƒ†ã‚­ã‚¹ãƒˆã‚’ä¸­å¤®ã«è¡¨ç¤º
            ctx.fillStyle = '#000000';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆä¸­...', size/2, size/2 - 10);
            ctx.fillText('ä¸‹è¨˜URLã‚’æ‰‹å‹•å…¥åŠ›:', size/2, size/2 + 10);
            ctx.font = '10px Arial';
            ctx.fillText(text, size/2, size/2 + 30);
        }

        // ã‚·ãƒ³ãƒ—ãƒ«ãªQRã‚³ãƒ¼ãƒ‰ç”Ÿæˆï¼ˆãƒ‰ãƒƒãƒˆè¡Œåˆ—æ–¹å¼ï¼‰
        function generateQR(text, canvas) {
            const ctx = canvas.getContext('2d');
            const size = canvas.width;
            const qrSize = 25; // 25x25ã®ãƒãƒˆãƒªãƒƒã‚¯ã‚¹
            const cellSize = size / qrSize;
            
            // èƒŒæ™¯ã‚’ç™½ã§å¡—ã‚Šã¤ã¶ã—
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, size, size);
            
            // ç°¡æ˜“QRã‚³ãƒ¼ãƒ‰ãƒ‘ã‚¿ãƒ¼ãƒ³ç”Ÿæˆ
            ctx.fillStyle = '#000000';
            
            // ä½ç½®æ¤œå‡ºãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆå·¦ä¸Šã€å³ä¸Šã€å·¦ä¸‹ï¼‰
            drawPositionPattern(ctx, 0, 0, cellSize);
            drawPositionPattern(ctx, 18, 0, cellSize);
            drawPositionPattern(ctx, 0, 18, cellSize);
            
            // ãƒ‡ãƒ¼ã‚¿éƒ¨åˆ†ï¼ˆãƒ†ã‚­ã‚¹ãƒˆã®ãƒãƒƒã‚·ãƒ¥ãƒ™ãƒ¼ã‚¹ï¼‰
            let hash = 0;
            for (let i = 0; i < text.length; i++) {
                const char = text.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            
            // ãƒ‡ãƒ¼ã‚¿ãƒ‘ã‚¿ãƒ¼ãƒ³æç”»
            for (let y = 0; y < qrSize; y++) {
                for (let x = 0; x < qrSize; x++) {
                    // ä½ç½®æ¤œå‡ºãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’é¿ã‘ã‚‹
                    if (isPositionPattern(x, y)) continue;
                    
                    // ãƒãƒƒã‚·ãƒ¥ãƒ™ãƒ¼ã‚¹ã§ãƒ‰ãƒƒãƒˆã‚’é…ç½®
                    const seed = hash + x * 31 + y * 17;
                    if (Math.abs(seed) % 3 === 0) {
                        ctx.fillRect(x * cellSize, y * cellSize, cellSize, cellSize);
                    }
                }
            }
        }
        
        function drawPositionPattern(ctx, startX, startY, cellSize) {
            // 7x7ã®ä½ç½®æ¤œå‡ºãƒ‘ã‚¿ãƒ¼ãƒ³
            const pattern = [
                [1,1,1,1,1,1,1],
                [1,0,0,0,0,0,1],
                [1,0,1,1,1,0,1],
                [1,0,1,1,1,0,1],
                [1,0,1,1,1,0,1],
                [1,0,0,0,0,0,1],
                [1,1,1,1,1,1,1]
            ];
            
            for (let y = 0; y < 7; y++) {
                for (let x = 0; x < 7; x++) {
                    if (pattern[y][x] === 1) {
                        ctx.fillRect((startX + x) * cellSize, (startY + y) * cellSize, cellSize, cellSize);
                    }
                }
            }
        }
        
        function isPositionPattern(x, y) {
            return (x < 9 && y < 9) || (x > 15 && y < 9) || (x < 9 && y > 15);
        }
        
        // QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆå®Ÿè¡Œ
        window.onload = function() {
            const url = 'http://192.168.2.7:3003';
            
            // ã¾ãšå¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§è©¦è¡Œ
            generateQRWithLibrary(url, 'qrcode');
            
            // ç¾åœ¨æ™‚åˆ»ã‚’è¡¨ç¤º
            const now = new Date().toLocaleString('ja-JP');
            document.getElementById('currentUrl').innerHTML += '<br><small>ç”Ÿæˆæ™‚åˆ»: ' + now + '</small>';
        };
    </script>
</body>
</html>
