<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é‡å¿ƒã‚±ã‚¢ã‚¢ãƒ—ãƒª - QRã‚³ãƒ¼ãƒ‰ã‚¢ã‚¯ã‚»ã‚¹</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
            text-align: center;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 30px;
        }
        .qr-section {
            margin: 30px 0;
            padding: 20px;
            border: 2px solid #ddd;
            border-radius: 8px;
        }
        .qr-code {
            margin: 20px auto;
            padding: 20px;
            background: white;
            display: inline-block;
            border-radius: 8px;
        }
        .url-text {
            font-size: 18px;
            font-weight: bold;
            color: #0066cc;
            margin: 15px 0;
        }
        .instructions {
            color: #666;
            margin: 15px 0;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¥ é‡å¿ƒã‚±ã‚¢ã‚¢ãƒ—ãƒª</h1>
        <p>é–‹ç™ºç‰ˆ - è·å“¡è©•ä¾¡ç”¨ã‚¢ã‚¯ã‚»ã‚¹</p>
        
        <div class="qr-section">
            <h2>ğŸ“± ãƒ­ãƒ¼ã‚«ãƒ«ã‚¢ã‚¯ã‚»ã‚¹ç”¨QRã‚³ãƒ¼ãƒ‰</h2>
            <div class="url-text">http://localhost:3003</div>
            <div class="qr-code" id="local-qr">
                <div>QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆä¸­...</div>
            </div>
            <div class="instructions">
                ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã®ã‚«ãƒ¡ãƒ©ã§QRã‚³ãƒ¼ãƒ‰ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã—ã¦ãã ã•ã„
            </div>
        </div>

        <div class="qr-section">
            <h2>ğŸŒ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¯ã‚»ã‚¹ç”¨QRã‚³ãƒ¼ãƒ‰</h2>
            <div class="url-text" id="network-url">IPã‚¢ãƒ‰ãƒ¬ã‚¹å–å¾—ä¸­...</div>
            <div class="qr-code" id="network-qr">
                <div>IPã‚¢ãƒ‰ãƒ¬ã‚¹å–å¾—ä¸­...</div>
            </div>
            <div class="instructions">
                åŒã˜Wi-Fiãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å†…ã®ä»–ã®ç«¯æœ«ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ç”¨
            </div>
        </div>

        <div class="status info">
            <strong>ğŸ“‹ ã‚¢ã‚¯ã‚»ã‚¹æ‰‹é †</strong><br>
            1. ä¸Šè¨˜QRã‚³ãƒ¼ãƒ‰ã‚’ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã§ã‚¹ã‚­ãƒ£ãƒ³<br>
            2. è¡¨ç¤ºã•ã‚ŒãŸãƒªãƒ³ã‚¯ã‚’ã‚¿ãƒƒãƒ—<br>
            3. ã‚¢ãƒ—ãƒªãŒé–‹ãã¾ã™
        </div>

        <div id="status-message" class="status info">
            ã‚µãƒ¼ãƒãƒ¼çŠ¶æ…‹ã‚’ç¢ºèªä¸­...
        </div>
    </div>

    <script>
        console.log('ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿é–‹å§‹');

        // ã‚·ãƒ³ãƒ—ãƒ«ãªQRã‚³ãƒ¼ãƒ‰ç”Ÿæˆï¼ˆASCIIï¼‰
        function generateSimpleQR(text, elementId) {
            console.log('ã‚·ãƒ³ãƒ—ãƒ«QRç”Ÿæˆ:', text);
            const qrText = `
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â–ˆâ–ˆ          â–ˆâ–ˆ      â–ˆâ–ˆ          â–ˆâ–ˆ
â–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆ  â–ˆâ–ˆ  â–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆ
â–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆ      â–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆ
â–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆ  â–ˆâ–ˆ  â–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆ
â–ˆâ–ˆ          â–ˆâ–ˆ  â–ˆâ–ˆ  â–ˆâ–ˆ          â–ˆâ–ˆ
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
                â–ˆâ–ˆ                
    QRã‚³ãƒ¼ãƒ‰: ${text}
                â–ˆâ–ˆ                
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â–ˆâ–ˆ          â–ˆâ–ˆ      â–ˆâ–ˆ          â–ˆâ–ˆ
â–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆ  â–ˆâ–ˆ  â–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆ
â–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆ      â–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆ
â–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆ  â–ˆâ–ˆ  â–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆ
â–ˆâ–ˆ          â–ˆâ–ˆ  â–ˆâ–ˆ  â–ˆâ–ˆ          â–ˆâ–ˆ
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
            `;
            
            document.getElementById(elementId).innerHTML = 
                '<pre style="font-family: monospace; font-size: 8px; line-height: 8px;">' + qrText + '</pre>' +
                '<div style="margin-top: 15px;"><a href="' + text + '" target="_blank" style="color: #0066cc; text-decoration: none; font-size: 16px; font-weight: bold;">ğŸ”— ç›´æ¥ãƒªãƒ³ã‚¯</a></div>';
        }

        // IPã‚¢ãƒ‰ãƒ¬ã‚¹å–å¾—ï¼ˆç°¡æ˜“ç‰ˆï¼‰
        function getIPAddress() {
            console.log('IPã‚¢ãƒ‰ãƒ¬ã‚¹å–å¾—é–‹å§‹');
            
            // WebRTCã‚’ä½¿ç”¨ã—ã¦IPã‚¢ãƒ‰ãƒ¬ã‚¹å–å¾—ã‚’è©¦è¡Œ
            try {
                const pc = new RTCPeerConnection({
                    iceServers: [{urls: 'stun:stun.l.google.com:19302'}]
                });
                
                pc.createDataChannel('');
                pc.createOffer().then(offer => pc.setLocalDescription(offer));
                
                pc.onicecandidate = (event) => {
                    if (event.candidate) {
                        const candidate = event.candidate.candidate;
                        const match = candidate.match(/(\d+\.\d+\.\d+\.\d+)/);
                        if (match && !match[1].startsWith('127.')) {
                            const ip = match[1];
                            console.log('IPã‚¢ãƒ‰ãƒ¬ã‚¹å–å¾—æˆåŠŸ:', ip);
                            pc.close();
                            
                            const networkUrl = `http://${ip}:3003`;
                            document.getElementById('network-url').textContent = networkUrl;
                            generateSimpleQR(networkUrl, 'network-qr');
                            return;
                        }
                    }
                };
                
                // 5ç§’å¾Œã«ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
                setTimeout(() => {
                    pc.close();
                    console.log('IPã‚¢ãƒ‰ãƒ¬ã‚¹å–å¾—ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ');
                    
                    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚µãƒ³ãƒ—ãƒ«è¡¨ç¤º
                    const sampleUrl = 'http://192.168.1.100:3003';
                    document.getElementById('network-url').innerHTML = 
                        sampleUrl + '<br><small style="color: #999;">(ã‚µãƒ³ãƒ—ãƒ« - å®Ÿéš›ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã«å¤‰æ›´ã—ã¦ãã ã•ã„)</small>';
                    generateSimpleQR(sampleUrl, 'network-qr');
                }, 5000);
                
            } catch (error) {
                console.error('WebRTC ã‚¨ãƒ©ãƒ¼:', error);
                
                // ã‚¨ãƒ©ãƒ¼æ™‚ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¡¨ç¤º
                const sampleUrl = 'http://192.168.1.100:3003';
                document.getElementById('network-url').innerHTML = 
                    sampleUrl + '<br><small style="color: #999;">(ã‚µãƒ³ãƒ—ãƒ« - å®Ÿéš›ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„)</small>';
                generateSimpleQR(sampleUrl, 'network-qr');
            }
        }

        // ã‚µãƒ¼ãƒãƒ¼çŠ¶æ…‹ãƒã‚§ãƒƒã‚¯
        function checkServerStatus() {
            console.log('ã‚µãƒ¼ãƒãƒ¼çŠ¶æ…‹ãƒã‚§ãƒƒã‚¯');
            fetch('http://localhost:3003')
                .then(response => {
                    if (response.ok) {
                        document.getElementById('status-message').className = 'status success';
                        document.getElementById('status-message').innerHTML = 
                            'âœ… <strong>é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ç¨¼åƒä¸­</strong><br>ã‚¢ãƒ—ãƒªã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã§ã™';
                    } else {
                        throw new Error('ã‚µãƒ¼ãƒãƒ¼å¿œç­”ã‚¨ãƒ©ãƒ¼');
                    }
                })
                .catch(error => {
                    console.error('ã‚µãƒ¼ãƒãƒ¼ãƒã‚§ãƒƒã‚¯ã‚¨ãƒ©ãƒ¼:', error);
                    document.getElementById('status-message').className = 'status error';
                    document.getElementById('status-message').innerHTML = 
                        'âŒ <strong>ã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã§ãã¾ã›ã‚“</strong><br>é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„';
                });
        }

        // åˆæœŸåŒ–
        window.addEventListener('load', function() {
            console.log('ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº† - åˆæœŸåŒ–é–‹å§‹');
            
            // ãƒ­ãƒ¼ã‚«ãƒ«ç”¨QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
            generateSimpleQR('http://localhost:3003', 'local-qr');
            
            // IPã‚¢ãƒ‰ãƒ¬ã‚¹å–å¾—ã¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç”¨QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
            getIPAddress();
            
            // ã‚µãƒ¼ãƒãƒ¼çŠ¶æ…‹ãƒã‚§ãƒƒã‚¯
            setTimeout(checkServerStatus, 2000);
        });
    </script>
</body>
</html>
