import React, { useState, useEffect } from 'react';
import { useData } from '../contexts/DataContext';
import { useNotification } from '../contexts/NotificationContext';
import { Save, Eye, Edit, Trash2, CheckCircle, Plus, X } from 'lucide-react';
import { 
  SAMPLE_STAFF, 
  TUBE_FEEDING_AMOUNT_OPTIONS, 
  TUBE_FEEDING_CONDITION_OPTIONS, 
  MEAL_FREE_TEXT_TEMPLATES, 
  WATER_TYPE_OPTIONS, 
  WATER_AMOUNT_OPTIONS 
} from '../../constants';
import { NotificationType } from '../types';

// é£Ÿäº‹è¨˜éŒ²ã®é¸æŠè‚¢ï¼ˆ15å€‹ã®å…·ä½“çš„æ‘‚å–é‡é¸æŠè‚¢ï¼‰
const mealIntakeOptions = [
  'å…¨é‡æ‘‚å–',
  '8å‰²ç¨‹åº¦æ‘‚å–',
  '6å‰²ç¨‹åº¦æ‘‚å–',
  '4å‰²ç¨‹åº¦æ‘‚å–',
  '2å‰²ç¨‹åº¦æ‘‚å–',
  'ä¸€å£ã ã‘',
  'å¥½ããªã‚‚ã®ã ã‘é£Ÿã¹ãŸ',
  'å«Œã„ãªã‚‚ã®ã¯æ®‹ã—ãŸ',
  'æ°´åˆ†ã®ã¿',
  'ãŠã‹ã‚†ã®ã¿',
  'æœç‰©ã®ã¿',
  'ãŠã‚„ã¤ã®ã¿',
  'çµŒç®¡æ „é¤Šã®ã¿',
  'çµŒç®¡æ „é¤Šï¼‹å°‘é‡çµŒå£',
  'æ‘‚å–ãªã—'
];

// é£Ÿäº‹çŠ¶æ³ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆ20å€‹ï¼‰
const mealSituationTemplates = [
  'ã‚†ã£ãã‚Šã¨ã€ã‚ˆãå™›ã‚“ã§é£Ÿã¹ãŸ',
  'é£Ÿæ¬²æ—ºç››ã§ã€ç©æ¥µçš„ã«é£Ÿã¹ãŸ',
  'å°‘ã—ãšã¤ã€æ™‚é–“ã‚’ã‹ã‘ã¦é£Ÿã¹ãŸ',
  'è·å“¡ã®å£°ã‹ã‘ã§ã€é£Ÿã¹å§‹ã‚ãŸ',
  'éŸ³æ¥½ã‚’è´ããªãŒã‚‰ã€ãƒªãƒ©ãƒƒã‚¯ã‚¹ã—ã¦é£Ÿã¹ãŸ',
  'å®¶æ—ã®å†™çœŸã‚’è¦‹ãªãŒã‚‰ã€å®‰å¿ƒã—ã¦é£Ÿã¹ãŸ',
  'å¥½ããªãƒ†ãƒ¬ãƒ“ç•ªçµ„ã‚’è¦‹ãªãŒã‚‰ã€æ¥½ã—ãã†ã«é£Ÿã¹ãŸ',
  'å¤–ã®æ™¯è‰²ã‚’è¦‹ãªãŒã‚‰ã€è½ã¡ç€ã„ã¦é£Ÿã¹ãŸ',
  'è·å“¡ã¨ç›®ã‚’åˆã‚ã›ãªãŒã‚‰ã€ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å–ã‚ŠãªãŒã‚‰é£Ÿã¹ãŸ',
  'æ‰‹ã‚’æ¡ã£ã¦ã‚‚ã‚‰ã„ãªãŒã‚‰ã€å®‰å¿ƒã—ã¦é£Ÿã¹ãŸ',
  'èƒŒä¸­ã‚’ã•ã™ã£ã¦ã‚‚ã‚‰ã„ãªãŒã‚‰ã€ãƒªãƒ©ãƒƒã‚¯ã‚¹ã—ã¦é£Ÿã¹ãŸ',
  'å£°ã‚’ã‹ã‘ã¦ã‚‚ã‚‰ã„ãªãŒã‚‰ã€åŠ±ã¾ã•ã‚Œã¦é£Ÿã¹ãŸ',
  'å°ã•ãåˆ‡ã£ã¦ã‚‚ã‚‰ã£ã¦ã€é£Ÿã¹ã‚„ã™ãã—ã¦ã‚‚ã‚‰ã£ãŸ',
  'æ¸©åº¦ã‚’èª¿æ•´ã—ã¦ã‚‚ã‚‰ã£ã¦ã€é£Ÿã¹ã‚„ã™ãã—ã¦ã‚‚ã‚‰ã£ãŸ',
  'å§¿å‹¢ã‚’èª¿æ•´ã—ã¦ã‚‚ã‚‰ã£ã¦ã€é£Ÿã¹ã‚„ã™ãã—ã¦ã‚‚ã‚‰ã£ãŸ',
  'ã‚¹ãƒ—ãƒ¼ãƒ³ã®è§’åº¦ã‚’èª¿æ•´ã—ã¦ã‚‚ã‚‰ã£ã¦ã€é£Ÿã¹ã‚„ã™ãã—ã¦ã‚‚ã‚‰ã£ãŸ',
  'ä¸€å£ã®é‡ã‚’èª¿æ•´ã—ã¦ã‚‚ã‚‰ã£ã¦ã€é£Ÿã¹ã‚„ã™ãã—ã¦ã‚‚ã‚‰ã£ãŸ',
  'ä¼‘æ†©ã‚’æŒŸã¿ãªãŒã‚‰ã€ã‚†ã£ãã‚Šã¨é£Ÿã¹ãŸ',
  'æ°´åˆ†ã‚’æŒŸã¿ãªãŒã‚‰ã€é£Ÿã¹ã‚„ã™ãã—ã¦ã‚‚ã‚‰ã£ãŸ',
  'é£Ÿå¾Œã®ã‚±ã‚¢ã‚’ã—ã¦ã‚‚ã‚‰ã£ã¦ã€å®‰å¿ƒã—ã¦é£Ÿã¹ãŸ'
];

// æ’æ³„è¨˜éŒ²ã®é¸æŠè‚¢
const excretionOptions = {
  bristolScale: ['1å‹', '2å‹', '3å‹', '4å‹', '5å‹', '6å‹', '7å‹'],
  amount: ['å°‘é‡', 'ä¸­é‡', 'å¤šé‡', 'å¾®é‡'],
  color: ['èŒ¶è‰²', 'é»’è‰²', 'ç·‘è‰²', 'é»„è‰²', 'ç™½è‰²', 'èµ¤è‰²'],
  skinCondition: ['è‰¯å¥½', 'è»½åº¦ã®ç™ºèµ¤', 'ä¸­ç­‰åº¦ã®ç™ºèµ¤', 'é‡åº¦ã®ç™ºèµ¤', 'ã³ã‚‰ã‚“', 'ãã®ä»–']
};

// ç¡çœ è¨˜éŒ²ã®ã‚¿ã‚°
const sleepTags = {
  fallingAsleep: ['ã‚¹ãƒ ãƒ¼ã‚º', 'æ™‚é–“ãŒã‹ã‹ã£ãŸ', 'å£°ã‹ã‘ãŒå¿…è¦', 'éŸ³æ¥½ã§ãƒªãƒ©ãƒƒã‚¯ã‚¹', 'èƒŒä¸­ã‚’ã•ã™ã£ã¦'],
  duringSleep: ['ãã£ã™ã‚Šçœ ã£ãŸ', 'æ™‚ã€…ç›®ã‚’è¦šã¾ã—ãŸ', 'å¯è¿”ã‚Šã‚’æ‰“ã£ãŸ', 'ç¬‘é¡”ã§çœ ã£ãŸ', 'ç©ã‚„ã‹ãªè¡¨æƒ…', 'æ™‚ã€…å£°ã‚’å‡ºã—ãŸ', 'æ‰‹ã‚’å‹•ã‹ã—ãŸ']
};

// ç™ºä½œè¨˜éŒ²ã®é¸æŠè‚¢
const seizureOptions = [
  'å…¨èº«ã‘ã„ã‚Œã‚“',
  'éƒ¨åˆ†ã‘ã„ã‚Œã‚“',
  'æ¬ ç¥ç™ºä½œ',
  'ãƒŸã‚ªã‚¯ãƒ­ãƒ¼ãƒŒã‚¹',
  'å¼·ç›´ç™ºä½œ',
  'é–“ä»£ç™ºä½œ',
  'å¼·ç›´é–“ä»£ç™ºä½œ',
  'è„±åŠ›ç™ºä½œ',
  'è¤‡é›‘éƒ¨åˆ†ç™ºä½œ',
  'å˜ç´”éƒ¨åˆ†ç™ºä½œ',
  'ãã®ä»–'
];

// ç™ºä½œã®ç¨®é¡ã®è§£èª¬
const seizureExplanations = {
  'å…¨èº«ã‘ã„ã‚Œã‚“': 'å…¨èº«ã®ç­‹è‚‰ãŒç¡¬ç›´ã—ã€ã‘ã„ã‚Œã‚“ã™ã‚‹ç™ºä½œã€‚æ„è­˜ã‚’å¤±ã†ã“ã¨ãŒå¤šã„ã€‚',
  'éƒ¨åˆ†ã‘ã„ã‚Œã‚“': 'ä½“ã®ä¸€éƒ¨ï¼ˆæ‰‹ã€è¶³ã€é¡”ãªã©ï¼‰ã®ã¿ãŒã‘ã„ã‚Œã‚“ã™ã‚‹ç™ºä½œã€‚',
  'æ¬ ç¥ç™ºä½œ': 'çªç„¶æ„è­˜ãŒé€”åˆ‡ã‚Œã€æ•°ç§’é–“ãƒœãƒ¼ãƒƒã¨ã™ã‚‹ç™ºä½œã€‚',
  'ãƒŸã‚ªã‚¯ãƒ­ãƒ¼ãƒŒã‚¹': 'ç¬é–“çš„ãªç­‹è‚‰ã®åç¸®ã«ã‚ˆã‚‹ã€ãƒ”ã‚¯ãƒƒã¨ã—ãŸå‹•ãã®ç™ºä½œã€‚',
  'å¼·ç›´ç™ºä½œ': 'ç­‹è‚‰ãŒç¡¬ç›´ã™ã‚‹ç™ºä½œã€‚ã‘ã„ã‚Œã‚“ã¯ä¼´ã‚ãªã„ã€‚',
  'é–“ä»£ç™ºä½œ': 'ç­‹è‚‰ã®åç¸®ã¨å¼›ç·©ãŒç¹°ã‚Šè¿”ã•ã‚Œã‚‹ã‘ã„ã‚Œã‚“ç™ºä½œã€‚',
  'å¼·ç›´é–“ä»£ç™ºä½œ': 'å¼·ç›´ç›¸ã¨é–“ä»£ç›¸ãŒç¶šãã€å…¸å‹çš„ãªã¦ã‚“ã‹ã‚“ç™ºä½œã€‚',
  'è„±åŠ›ç™ºä½œ': 'çªç„¶ç­‹è‚‰ã®åŠ›ãŒæŠœã‘ã¦ã€å€’ã‚Œã‚‹ç™ºä½œã€‚',
  'è¤‡é›‘éƒ¨åˆ†ç™ºä½œ': 'æ„è­˜éšœå®³ã‚’ä¼´ã†éƒ¨åˆ†ç™ºä½œã€‚è‡ªå‹•ç—‡ã‚’ä¼´ã†ã“ã¨ãŒã‚ã‚‹ã€‚',
  'å˜ç´”éƒ¨åˆ†ç™ºä½œ': 'æ„è­˜ã‚’ä¿ã£ãŸã¾ã¾ã®éƒ¨åˆ†ç™ºä½œã€‚',
  'ãã®ä»–': 'ä¸Šè¨˜ã«å½“ã¦ã¯ã¾ã‚‰ãªã„ç™ºä½œã€‚è©³ç´°ã‚’è¨˜éŒ²ã—ã¦ãã ã•ã„ã€‚'
};

// è¦‹ãŸã¾ã¾ã®ç¾è±¡ã®é¸æŠè‚¢
const seizurePhenomenonOptions = [
  'ç›®ã‚’ç™½é»’ã•ã›ã‚‹',
  'å£ã‹ã‚‰æ³¡ã‚’å¹ã',
  'èˆŒã‚’å™›ã‚€',
  'å°¿å¤±ç¦',
  'ä¾¿å¤±ç¦',
  'æ‰‹è¶³ã‚’ãƒã‚¿ãƒã‚¿ã•ã›ã‚‹',
  'ä½“ã‚’ç¡¬ç›´ã•ã›ã‚‹',
  'æ„è­˜ã‚’å¤±ã†',
  'ãƒœãƒ¼ãƒƒã¨ã™ã‚‹',
  'æ‰‹ã‚’å‹•ã‹ã™',
  'å£ã‚’ãƒ¢ã‚°ãƒ¢ã‚°ã™ã‚‹',
  'ã‚ˆã ã‚ŒãŒå‡ºã‚‹',
  'å‘¼å¸ãŒè’ããªã‚‹',
  'é¡”è‰²ãŒæ‚ªããªã‚‹',
  'ç™ºæ±—',
  'ãã®ä»–'
];

// ç™ºä½œè¨˜éŒ²ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
const seizureTemplates = [
  'çªç„¶æ„è­˜ã‚’å¤±ã„ã€å…¨èº«ãŒã‘ã„ã‚Œã‚“ã—ãŸã€‚ç´„2åˆ†é–“ç¶šã„ãŸã€‚',
  'å³åŠèº«ã®ã¿ãŒã‘ã„ã‚Œã‚“ã—ãŸã€‚æ„è­˜ã¯ä¿ãŸã‚Œã¦ã„ãŸã€‚',
  'æ•°ç§’é–“ãƒœãƒ¼ãƒƒã¨ã—ã¦ã€å‘¼ã³ã‹ã‘ã«åå¿œã—ãªã‹ã£ãŸã€‚',
  'ç¬é–“çš„ã«æ‰‹è¶³ãŒãƒ”ã‚¯ãƒƒã¨ã—ãŸã€‚',
  'ä½“ãŒç¡¬ç›´ã—ã€å‘¼å¸ãŒä¸€æ™‚çš„ã«æ­¢ã¾ã£ãŸã‚ˆã†ã«è¦‹ãˆãŸã€‚',
  'æ‰‹è¶³ã‚’ãƒã‚¿ãƒã‚¿ã•ã›ãªãŒã‚‰ã€å£ã‹ã‚‰æ³¡ã‚’å¹ã„ãŸã€‚',
  'çªç„¶åŠ›ãŒæŠœã‘ã¦ã€æ¤…å­ã‹ã‚‰æ»‘ã‚Šè½ã¡ãŸã€‚',
  'æ‰‹ã‚’å‹•ã‹ã—ãªãŒã‚‰ã€å£ã‚’ãƒ¢ã‚°ãƒ¢ã‚°ã—ã¦ã„ãŸã€‚',
  'ç›®ã‚’ç™½é»’ã•ã›ã€ã‚ˆã ã‚ŒãŒå‡ºã¦ã„ãŸã€‚',
  'å°¿å¤±ç¦ã‚’ä¼´ã„ã€å…¨èº«ã‘ã„ã‚Œã‚“ãŒç´„3åˆ†é–“ç¶šã„ãŸã€‚'
];

// æ´»å‹•å‚åŠ ã®é¸æŠè‚¢
const activityOptions = [
  'éŸ³æ¥½ç™‚æ³•',
  'ä½œæ¥­ç™‚æ³•',
  'ç†å­¦ç™‚æ³•',
  'è¨€èªç™‚æ³•',
  'éŠã³ã®æ™‚é–“',
  'æ•£æ­©',
  'å…¥æµ´',
  'ç€æ›¿ãˆ',
  'é£Ÿäº‹',
  'ãŠã‚„ã¤',
  'ãƒ†ãƒ¬ãƒ“è¦–è´',
  'çµµæœ¬ã®èª­ã¿èã‹ã›',
  'æ‰‹éŠã³',
  'ãƒœãƒ¼ãƒ«éŠã³',
  'ãŠã‚‚ã¡ã‚ƒéŠã³',
  'ãã®ä»–'
];

// è¡¨æƒ…ãƒ»æ°—åˆ†ã®é¸æŠè‚¢
const moodOptions = [
  'ç¬‘é¡”',
  'ç©ã‚„ã‹',
  'ãƒªãƒ©ãƒƒã‚¯ã‚¹',
  'èˆˆå‘³é–¢å¿ƒ',
  'å–œã³',
  'å®‰å¿ƒ',
  'æº€è¶³',
  'æ´»æ°—',
  'é›†ä¸­',
  'ä¸å¿«',
  'ç·Šå¼µ',
  'ä¸å®‰',
  'ç–²åŠ´',
  'ç—›ã¿',
  'ãã®ä»–'
];

// ç‰¹è¨˜äº‹é …ã‚«ãƒ†ã‚´ãƒªãƒ¼
const specialNotesCategories = [
  'åŒ»ç™‚çš„ã‚±ã‚¢',
  'ãƒã‚¸ã‚·ãƒ§ãƒ‹ãƒ³ã‚°',
  'ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³',
  'å®¶æ—é€£æº',
  'è·å“¡é–“é€£æº',
  'ç’°å¢ƒèª¿æ•´',
  'ãã®ä»–'
];

// é£Ÿäº‹è¨˜éŒ²ã®å‹å®šç¾©
interface MealRecord {
  id: string;
  date: string;
  recorder: string;
  intakeMethod: 'çµŒå£' | 'çµŒç®¡æ „é¤Š';
  mealIntake: string;
  mealSituation: string;
  mealFreeText: string;
  waterType: string;
  waterAmount: number;
  createdAt: string;
  updatedAt: string;
}

// ç™ºä½œè¨˜éŒ²ã®å‹å®šç¾©
interface SeizureRecord {
  id: string;
  date: string;
  recorder: string;
  seizureType: string;
  seizurePhenomenon: string[];
  seizureStartTime: string;
  seizureEndTime: string;
  seizureDuration: string;
  seizureTemplate: string;
  seizureFreeText: string;
  createdAt: string;
  updatedAt: string;
}

// ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿å‹ã‚’æŠ½å‡º
interface FormDataType {
  date: string;
  recorder: string;
  intakeMethod: 'çµŒå£' | 'çµŒç®¡æ „é¤Š';
  mealIntake: string;
  mealSituation: string;
  mealFreeText: string;
  waterType: string;
  waterAmount: number;
  excretionBristol: string;
  excretionAmount: string;
  excretionColor: string;
  excretionSkin: string;
  excretionFreeText: string;
  sleepFalling: string[];
  sleepDuring: string[];
  sleepFreeText: string;
  seizureType: string;
  seizurePhenomenon: string[];
  seizureStartTime: string;
  seizureEndTime: string;
  seizureDuration: string;
  seizureTemplate: string;
  seizureFreeText: string;
  activityParticipation: string[];
  mood: string[];
  specialNotesCategory: string;
  specialNotesFreeText: string;
}

const DailyLogNewPage: React.FC = () => {
  const { showNotification } = useNotification();
  const { staff } = useData();
  const [formData, setFormData] = useState<FormDataType>({
    date: new Date().toISOString().split('T')[0],
    recorder: '',
    intakeMethod: 'çµŒå£',
    mealIntake: '',
    mealSituation: '',
    mealFreeText: '',
    waterType: 'æ°´',
    waterAmount: 100,
    excretionBristol: '',
    excretionAmount: '',
    excretionColor: '',
    excretionSkin: '',
    excretionFreeText: '',
    sleepFalling: [],
    sleepDuring: [],
    sleepFreeText: '',
    seizureType: '',
    seizurePhenomenon: [],
    seizureStartTime: '',
    seizureEndTime: '',
    seizureDuration: '',
    seizureTemplate: '',
    seizureFreeText: '',
    activityParticipation: [],
    mood: [],
    specialNotesCategory: '',
    specialNotesFreeText: ''
  });

  // ä¿å­˜ã•ã‚ŒãŸé£Ÿäº‹è¨˜éŒ²ã®çŠ¶æ…‹
  const [savedMealRecords, setSavedMealRecords] = useState<MealRecord[]>([]);
  const [isViewingRecords, setIsViewingRecords] = useState(false);
  const [editingRecord, setEditingRecord] = useState<MealRecord | null>(null);

  // ä¿å­˜ã•ã‚ŒãŸç™ºä½œè¨˜éŒ²ã®çŠ¶æ…‹
  const [savedSeizureRecords, setSavedSeizureRecords] = useState<SeizureRecord[]>([]);
  const [isViewingSeizureRecords, setIsViewingSeizureRecords] = useState(false);
  const [editingSeizureRecord, setEditingSeizureRecord] = useState<SeizureRecord | null>(null);
  const [showSeizureExplanation, setShowSeizureExplanation] = useState<string | null>(null);

  const [seizureTimer, setSeizureTimer] = useState<{
    isRunning: boolean;
    startTime: Date | null;
    duration: string;
  }>({
    isRunning: false,
    startTime: null,
    duration: '00:00'
  });

  // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰ä¿å­˜ã•ã‚ŒãŸè¨˜éŒ²ã‚’èª­ã¿è¾¼ã¿
  useEffect(() => {
    const savedRecords = localStorage.getItem('mealRecords');
    if (savedRecords) {
      setSavedMealRecords(JSON.parse(savedRecords));
    }
    
    const savedSeizureRecords = localStorage.getItem('seizureRecords');
    if (savedSeizureRecords) {
      setSavedSeizureRecords(JSON.parse(savedSeizureRecords));
    }
  }, []);

  // æŒ‡ä»¤1: è¨˜éŒ²è€…ã‚’24åã®è·å“¡åã«è¨­å®š
  const staffOptions = staff?.map(s => ({ value: s.id, label: s.name })) || [];

  // æŒ‡ä»¤2: çµŒç®¡æ „é¤Šã®æ‘‚å–é‡é¸æŠè‚¢ã‚’å‹•çš„ã«å¤‰æ›´
  const getMealIntakeOptions = () => {
    if (formData.intakeMethod === 'çµŒç®¡æ „é¤Š') {
      return TUBE_FEEDING_AMOUNT_OPTIONS;
    }
    return mealIntakeOptions;
  };

  // æŒ‡ä»¤3: çµŒç®¡æ „é¤Šã®é£Ÿäº‹ã®æ§˜å­é¸æŠè‚¢ã‚’å‹•çš„ã«å¤‰æ›´
  const getMealSituationOptions = () => {
    if (formData.intakeMethod === 'çµŒç®¡æ „é¤Š') {
      return TUBE_FEEDING_CONDITION_OPTIONS;
    }
    return mealSituationTemplates;
  };

  const handleInputChange = (field: keyof FormDataType, value: any) => {
    setFormData(prev => ({
      ...prev,
      [field]: value
    }));
  };

  const handleArrayChange = (field: keyof FormDataType, value: string, checked: boolean) => {
    setFormData(prev => ({
      ...prev,
      [field]: checked
        ? [...(prev[field] as string[]), value]
        : (prev[field] as string[]).filter((item: string) => item !== value)
    }));
  };

  // æŒ‡ä»¤4: é£Ÿäº‹è‡ªç”±è¨˜è¿°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®é©ç”¨
  const applyMealTemplate = (template: string) => {
    setFormData(prev => ({
      ...prev,
      mealFreeText: prev.mealFreeText + (prev.mealFreeText ? '\n' : '') + template
    }));
  };

  // é£Ÿäº‹è¨˜éŒ²ã®ä¿å­˜
  const saveMealRecord = () => {
    if (!formData.recorder.trim()) {
      showNotification('è¨˜éŒ²è€…åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', NotificationType.ERROR);
      return;
    }

    const newRecord: MealRecord = {
      id: Date.now().toString(),
      date: formData.date,
      recorder: formData.recorder,
      intakeMethod: formData.intakeMethod,
      mealIntake: formData.mealIntake,
      mealSituation: formData.mealSituation,
      mealFreeText: formData.mealFreeText,
      waterType: formData.waterType,
      waterAmount: formData.waterAmount,
      createdAt: new Date().toISOString(),
      updatedAt: new Date().toISOString()
    };

    const updatedRecords = [...savedMealRecords, newRecord];
    setSavedMealRecords(updatedRecords);
    localStorage.setItem('mealRecords', JSON.stringify(updatedRecords));

    // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ
    setFormData(prev => ({
      ...prev,
      intakeMethod: 'çµŒå£',
      mealIntake: '',
      mealSituation: '',
      mealFreeText: '',
      waterType: 'æ°´',
      waterAmount: 100
    }));

    showNotification('é£Ÿäº‹è¨˜éŒ²ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼', NotificationType.SUCCESS);
  };

  // é£Ÿäº‹è¨˜éŒ²ã®ç·¨é›†
  const editMealRecord = (record: MealRecord) => {
    setEditingRecord(record);
    setFormData(prev => ({
      ...prev,
      date: record.date,
      recorder: record.recorder,
      intakeMethod: record.intakeMethod,
      mealIntake: record.mealIntake,
      mealSituation: record.mealSituation,
      mealFreeText: record.mealFreeText,
      waterType: record.waterType,
      waterAmount: record.waterAmount
    }));
  };

  // é£Ÿäº‹è¨˜éŒ²ã®æ›´æ–°
  const updateMealRecord = () => {
    if (!editingRecord) return;

    const updatedRecord: MealRecord = {
      ...editingRecord,
      date: formData.date,
      recorder: formData.recorder,
      intakeMethod: formData.intakeMethod,
      mealIntake: formData.mealIntake,
      mealSituation: formData.mealSituation,
      mealFreeText: formData.mealFreeText,
      waterType: formData.waterType,
      waterAmount: formData.waterAmount,
      updatedAt: new Date().toISOString()
    };

    const updatedRecords = savedMealRecords.map(record => 
      record.id === editingRecord.id ? updatedRecord : record
    );
    setSavedMealRecords(updatedRecords);
    localStorage.setItem('mealRecords', JSON.stringify(updatedRecords));

    setEditingRecord(null);
    showNotification('é£Ÿäº‹è¨˜éŒ²ã‚’æ›´æ–°ã—ã¾ã—ãŸï¼', NotificationType.SUCCESS);
  };

  // é£Ÿäº‹è¨˜éŒ²ã®å‰Šé™¤
  const deleteMealRecord = (id: string) => {
    if (window.confirm('ã“ã®è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
      const updatedRecords = savedMealRecords.filter(record => record.id !== id);
      setSavedMealRecords(updatedRecords);
      localStorage.setItem('mealRecords', JSON.stringify(updatedRecords));
      showNotification('é£Ÿäº‹è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã—ãŸ', NotificationType.SUCCESS);
    }
  };

  // ç™ºä½œè¨˜éŒ²ã®ä¿å­˜
  const saveSeizureRecord = () => {
    if (!formData.recorder.trim()) {
      showNotification('è¨˜éŒ²è€…åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', NotificationType.ERROR);
      return;
    }

    const newRecord: SeizureRecord = {
      id: Date.now().toString(),
      date: formData.date,
      recorder: formData.recorder,
      seizureType: formData.seizureType,
      seizurePhenomenon: formData.seizurePhenomenon,
      seizureStartTime: formData.seizureStartTime,
      seizureEndTime: formData.seizureEndTime,
      seizureDuration: formData.seizureDuration,
      seizureTemplate: formData.seizureTemplate,
      seizureFreeText: formData.seizureFreeText,
      createdAt: new Date().toISOString(),
      updatedAt: new Date().toISOString()
    };

    const updatedRecords = [...savedSeizureRecords, newRecord];
    setSavedSeizureRecords(updatedRecords);
    localStorage.setItem('seizureRecords', JSON.stringify(updatedRecords));

    // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ
    setFormData(prev => ({
      ...prev,
      seizureType: '',
      seizurePhenomenon: [],
      seizureStartTime: '',
      seizureEndTime: '',
      seizureDuration: '',
      seizureTemplate: '',
      seizureFreeText: ''
    }));

    showNotification('ç™ºä½œè¨˜éŒ²ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼', NotificationType.SUCCESS);
  };

  // ç™ºä½œè¨˜éŒ²ã®ç·¨é›†
  const editSeizureRecord = (record: SeizureRecord) => {
    setEditingSeizureRecord(record);
    setFormData(prev => ({
      ...prev,
      date: record.date,
      recorder: record.recorder,
      seizureType: record.seizureType,
      seizurePhenomenon: record.seizurePhenomenon,
      seizureStartTime: record.seizureStartTime,
      seizureEndTime: record.seizureEndTime,
      seizureDuration: record.seizureDuration,
      seizureTemplate: record.seizureTemplate,
      seizureFreeText: record.seizureFreeText
    }));
  };

  // ç™ºä½œè¨˜éŒ²ã®æ›´æ–°
  const updateSeizureRecord = () => {
    if (!editingSeizureRecord) return;

    const updatedRecord: SeizureRecord = {
      ...editingSeizureRecord,
      date: formData.date,
      recorder: formData.recorder,
      seizureType: formData.seizureType,
      seizurePhenomenon: formData.seizurePhenomenon,
      seizureStartTime: formData.seizureStartTime,
      seizureEndTime: formData.seizureEndTime,
      seizureDuration: formData.seizureDuration,
      seizureTemplate: formData.seizureTemplate,
      seizureFreeText: formData.seizureFreeText,
      updatedAt: new Date().toISOString()
    };

    const updatedRecords = savedSeizureRecords.map(record => 
      record.id === editingSeizureRecord.id ? updatedRecord : record
    );
    setSavedSeizureRecords(updatedRecords);
    localStorage.setItem('seizureRecords', JSON.stringify(updatedRecords));

    setEditingSeizureRecord(null);
    showNotification('ç™ºä½œè¨˜éŒ²ã‚’æ›´æ–°ã—ã¾ã—ãŸï¼', NotificationType.SUCCESS);
  };

  // ç™ºä½œè¨˜éŒ²ã®å‰Šé™¤
  const deleteSeizureRecord = (id: string) => {
    if (window.confirm('ã“ã®ç™ºä½œè¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
      const updatedRecords = savedSeizureRecords.filter(record => record.id !== id);
      setSavedSeizureRecords(updatedRecords);
      localStorage.setItem('seizureRecords', JSON.stringify(updatedRecords));
      showNotification('ç™ºä½œè¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã—ãŸ', NotificationType.SUCCESS);
    }
  };

  const startSeizureTimer = () => {
    setSeizureTimer({
      isRunning: true,
      startTime: new Date() as Date,
      duration: '00:00'
    });
  };

  const stopSeizureTimer = () => {
    setSeizureTimer(prev => ({
      ...prev,
      isRunning: false
    }));
  };

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    console.log('è¨˜éŒ²ãƒ‡ãƒ¼ã‚¿:', formData);
    alert('ãã‚‰ã‚ãã®è¨˜éŒ²ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼');
  };

  return (
    <>
      <div className="p-6 bg-gradient-to-br from-blue-50 to-indigo-50 min-h-screen">
        <div className="max-w-4xl mx-auto">
          <h1 className="text-3xl font-bold mb-1 text-gray-800">æ—¥èªŒæ–°è¦ä½œæˆãƒ»è¨˜éŒ²å…¥åŠ›</h1>
          <div className="text-sm text-gray-400 mb-2">ãã‚‰ã‚ãã®è¨˜éŒ²ï¼šå¿ƒè‡“éƒ¨</div>
          <p className="text-lg text-gray-600 mb-8">è¦‹ãŸã¾ã¾ã€æ„Ÿã˜ãŸã¾ã¾ã‚’ã€å‘¼å¸ã™ã‚‹ã‚ˆã†ã«è¨˜éŒ²ã—ã¾ã—ã‚‡ã†</p>

          <form onSubmit={handleSubmit} className="space-y-8">
            {/* åŸºæœ¬æƒ…å ± (é­‚ã®å™¨) */}
            <div className="card bg-white shadow-lg rounded-xl p-6">
              <h2 className="text-xl font-bold mb-4 text-gray-800">åŸºæœ¬æƒ…å ± (é­‚ã®å™¨)</h2>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label htmlFor="basic-date-input">æ—¥ä»˜</label>
                  <input
                    id="basic-date-input"
                    name="basicDate"
                    type="date"
                    value={formData.date}
                    onChange={(e) => handleInputChange('date', e.target.value)}
                    aria-label="æ—¥ä»˜ã‚’é¸æŠã—ã¦ãã ã•ã„"
                    title="æ—¥ä»˜ã‚’é¸æŠã—ã¦ãã ã•ã„"
                    placeholder="æ—¥ä»˜ã‚’é¸æŠ"
                    className="w-full border rounded-lg p-3 focus:ring-2 focus:ring-blue-500"
                  />
                </div>
                <div>
                  <label htmlFor="basic-recorder-input">è¨˜éŒ²è€…</label>
                  <input
                    id="basic-recorder-input"
                    name="basicRecorder"
                    type="text"
                    value={formData.recorder}
                    onChange={(e) => handleInputChange('recorder', e.target.value)}
                    aria-label="è¨˜éŒ²è€…ã®ãŠåå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"
                    title="è¨˜éŒ²è€…ã®ãŠåå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"
                    placeholder="è¨˜éŒ²è€…ã®ãŠåå‰"
                    className="w-full border rounded-lg p-3 focus:ring-2 focus:ring-blue-500"
                  />
                </div>
              </div>
            </div>

            {/* é£Ÿäº‹è¨˜éŒ² (é­‚ã®æ „é¤Š) */}
            <div className="card bg-white shadow-lg rounded-xl p-6">
              <h2 className="text-xl font-bold mb-4 text-green-600">ğŸ½ï¸ é£Ÿäº‹è¨˜éŒ² (é­‚ã®æ „é¤Š)</h2>
              <div className="space-y-4">
                <div>
                  <label htmlFor="meal-time-input">æ™‚é–“</label>
                  <input
                    id="meal-time-input"
                    name="mealTime"
                    type="time"
                    aria-label="é£Ÿäº‹ã®æ™‚é–“ã‚’é¸æŠã—ã¦ãã ã•ã„"
                    title="é£Ÿäº‹ã®æ™‚é–“ã‚’é¸æŠã—ã¦ãã ã•ã„"
                    className="w-full border rounded-lg p-3 focus:ring-2 focus:ring-green-500"
                  />
                </div>
                <div>
                  <fieldset>
                    <legend className="block font-semibold text-gray-700 mb-2">æ‘‚å–æ–¹æ³•</legend>
                    <div className="flex gap-4">
                      <label className="flex items-center">
                        <input
                          type="radio"
                          name="intakeMethod"
                          value="çµŒå£"
                          checked={formData.intakeMethod === 'çµŒå£'}
                          onChange={(e) => handleInputChange('intakeMethod', e.target.value)}
                          className="mr-2"
                          aria-label="çµŒå£æ‘‚å–"
                        />
                        çµŒå£
                      </label>
                      <label className="flex items-center">
                        <input
                          type="radio"
                          name="intakeMethod"
                          value="çµŒç®¡æ „é¤Š"
                          checked={formData.intakeMethod === 'çµŒç®¡æ „é¤Š'}
                          onChange={(e) => handleInputChange('intakeMethod', e.target.value)}
                          className="mr-2"
                          aria-label="çµŒç®¡æ „é¤Š"
                        />
                        çµŒç®¡æ „é¤Š
                      </label>
                    </div>
                  </fieldset>
                </div>
                <div>
                  <label htmlFor="meal-intake-select">é£Ÿäº‹æ‘‚å–é‡</label>
                  <select
                    id="meal-intake-select"
                    name="mealIntake"
                    value={formData.mealIntake}
                    onChange={(e) => handleInputChange('mealIntake', e.target.value)}
                    aria-label="é£Ÿäº‹æ‘‚å–é‡ã‚’é¸æŠã—ã¦ãã ã•ã„"
                    title="é£Ÿäº‹æ‘‚å–é‡ã‚’é¸æŠã—ã¦ãã ã•ã„"
                    className="w-full border rounded-lg p-3 focus:ring-2 focus:ring-green-500"
                  >
                    <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                    {getMealIntakeOptions().map((option, index) => (
                      <option key={index} value={option}>{option}</option>
                    ))}
                  </select>
                </div>
                <div>
                  <label htmlFor="meal-situation-select">é£Ÿäº‹ã®æ§˜å­</label>
                  <select
                    id="meal-situation-select"
                    name="mealSituation"
                    value={formData.mealSituation}
                    onChange={(e) => handleInputChange('mealSituation', e.target.value)}
                    aria-label="é£Ÿäº‹ã®æ§˜å­ã‚’é¸æŠã—ã¦ãã ã•ã„"
                    title="é£Ÿäº‹ã®æ§˜å­ã‚’é¸æŠã—ã¦ãã ã•ã„"
                    className="w-full border rounded-lg p-3 focus:ring-2 focus:ring-green-500"
                  >
                    <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                    {getMealSituationOptions().map((template, index) => (
                      <option key={index} value={template}>{template}</option>
                    ))}
                  </select>
                </div>
                <div>
                  <label htmlFor="meal-free-template-select" className="block font-semibold text-gray-700 mb-2">é£Ÿäº‹è‡ªç”±è¨˜è¿°ï¼ˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠï¼‰</label>
                  <select
                    id="meal-free-template-select"
                    name="mealFreeTextTemplate"
                    aria-label="é£Ÿäº‹è‡ªç”±è¨˜è¿°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠ"
                    className="w-full border rounded-lg p-3 focus:ring-2 focus:ring-green-500 mb-2"
                    value=""
                    onChange={e => {
                      const selected = e.target.value;
                      if (selected) {
                        setFormData(prev => ({
                          ...prev,
                          mealFreeText: selected
                        }));
                      }
                    }}
                  >
                    <option value="">ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„</option>
                    {MEAL_FREE_TEXT_TEMPLATES.map((template, idx) => (
                      <option key={idx} value={template}>{template}</option>
                    ))}
                  </select>
                  <textarea
                    id="meal-free-text"
                    name="mealFreeText"
                    value={formData.mealFreeText}
                    onChange={(e) => handleInputChange('mealFreeText', e.target.value)}
                    aria-label="é£Ÿäº‹ã®æ§˜å­ã«ã¤ã„ã¦è‡ªç”±ã«è¨˜éŒ²ã—ã¦ãã ã•ã„"
                    title="é£Ÿäº‹ã®æ§˜å­ã«ã¤ã„ã¦è‡ªç”±ã«è¨˜éŒ²ã—ã¦ãã ã•ã„"
                    placeholder="é£Ÿäº‹ã®æ§˜å­ã«ã¤ã„ã¦ã€è‡ªç”±ã«è¨˜éŒ²ã—ã¦ãã ã•ã„..."
                    className="w-full border rounded-lg p-3 h-24 focus:ring-2 focus:ring-green-500"
                  />
                </div>
                <div>
                  <fieldset>
                    <legend className="block font-semibold text-gray-700 mb-2">æ°´åˆ†ã®ç¨®é¡</legend>
                    <div className="flex flex-wrap gap-2">
                      {WATER_TYPE_OPTIONS.map((type, index) => (
                        <button
                          key={type}
                          type="button"
                          onClick={() => handleInputChange('waterType', type)}
                          className={`px-3 py-1 rounded-full text-sm border transition-colors ${
                            formData.waterType === type
                              ? 'bg-blue-600 text-white border-blue-600'
                              : 'bg-white text-gray-700 border-gray-300 hover:bg-gray-50'
                          }`}
                          aria-label={`æ°´åˆ†ã®ç¨®é¡: ${type}`}
                          aria-pressed={formData.waterType === type}
                          title={`æ°´åˆ†ã®ç¨®é¡: ${type}`}
                        >
                          {type}
                        </button>
                      ))}
                    </div>
                  </fieldset>
                </div>
                <div>
                  <label htmlFor="water-amount-select" className="block font-semibold text-gray-700 mb-2">æ°´åˆ†é‡</label>
                  <select
                    id="water-amount-select"
                    name="waterAmount"
                    value={typeof formData.waterAmount === 'number' ? formData.waterAmount : ''}
                    onChange={(e) => handleInputChange('waterAmount', parseInt(e.target.value))}
                    aria-label="æ°´åˆ†é‡ã‚’é¸æŠã—ã¦ãã ã•ã„"
                    className="w-full border rounded-lg p-3 focus:ring-2 focus:ring-green-500"
                  >
                    {WATER_AMOUNT_OPTIONS.map((amount, index) => (
                      <option key={index} value={amount}>
                        {amount}ml
                      </option>
                    ))}
                  </select>
                </div>
              </div>
            </div>

            {/* æ’æ³„è¨˜éŒ² (é­‚ã®æµ„åŒ–) */}
            <div className="card bg-white shadow-lg rounded-xl p-6">
              <h2 className="text-xl font-bold mb-4 text-orange-600">ğŸš½ æ’æ³„è¨˜éŒ² (é­‚ã®æµ„åŒ–)</h2>
              <div className="space-y-4">
                <div>
                  <label htmlFor="excretion-time-input">æ™‚é–“</label>
                  <input
                    id="excretion-time-input"
                    name="excretionTime"
                    type="time"
                    aria-label="æ’æ³„ã®æ™‚é–“ã‚’é¸æŠã—ã¦ãã ã•ã„"
                    title="æ’æ³„ã®æ™‚é–“ã‚’é¸æŠã—ã¦ãã ã•ã„"
                    className="w-full border rounded-lg p-3 focus:ring-2 focus:ring-orange-500"
                  />
                </div>
                <div>
                  <label htmlFor="excretion-bristol-select">ãƒ–ãƒªã‚¹ãƒˆãƒ«ã‚¹ã‚±ãƒ¼ãƒ«</label>
                  <select
                    id="excretion-bristol-select"
                    name="excretionBristol"
                    value={formData.excretionBristol}
                    onChange={(e) => handleInputChange('excretionBristol', e.target.value)}
                    aria-label="ãƒ–ãƒªã‚¹ãƒˆãƒ«ã‚¹ã‚±ãƒ¼ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„"
                    title="ãƒ–ãƒªã‚¹ãƒˆãƒ«ã‚¹ã‚±ãƒ¼ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„"
                    className="w-full border rounded-lg p-3 focus:ring-2 focus:ring-orange-500"
                  >
                    <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                    {excretionOptions.bristolScale.map((scale, index) => (
                      <option key={index} value={scale}>{scale}</option>
                    ))}
                  </select>
                </div>
                <div>
                  <label htmlFor="excretion-amount-select">æ’æ³„é‡</label>
                  <select
                    id="excretion-amount-select"
                    name="excretionAmount"
                    value={formData.excretionAmount}
                    onChange={(e) => handleInputChange('excretionAmount', e.target.value)}
                    aria-label="æ’æ³„é‡ã‚’é¸æŠã—ã¦ãã ã•ã„"
                    title="æ’æ³„é‡ã‚’é¸æŠã—ã¦ãã ã•ã„"
                    className="w-full border rounded-lg p-3 focus:ring-2 focus:ring-orange-500"
                  >
                    <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                    {excretionOptions.amount.map((amount, index) => (
                      <option key={index} value={amount}>{amount}</option>
                    ))}
                  </select>
                </div>
                <div>
                  <label htmlFor="excretion-color-select">ä¾¿ã®è‰²</label>
                  <select
                    id="excretion-color-select"
                    name="excretionColor"
                    value={formData.excretionColor}
                    onChange={(e) => handleInputChange('excretionColor', e.target.value)}
                    aria-label="ä¾¿ã®è‰²ã‚’é¸æŠã—ã¦ãã ã•ã„"
                    title="ä¾¿ã®è‰²ã‚’é¸æŠã—ã¦ãã ã•ã„"
                    className="w-full border rounded-lg p-3 focus:ring-2 focus:ring-orange-500"
                  >
                    <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                    {excretionOptions.color.map((color, index) => (
                      <option key={index} value={color}>{color}</option>
                    ))}
                  </select>
                </div>
                <div>
                  <label htmlFor="excretion-skin-select">çš®è†šã®çŠ¶æ…‹</label>
                  <select
                    id="excretion-skin-select"
                    name="excretionSkin"
                    value={formData.excretionSkin}
                    onChange={(e) => handleInputChange('excretionSkin', e.target.value)}
                    aria-label="çš®è†šã®çŠ¶æ…‹ã‚’é¸æŠã—ã¦ãã ã•ã„"
                    title="çš®è†šã®çŠ¶æ…‹ã‚’é¸æŠã—ã¦ãã ã•ã„"
                    className="w-full border rounded-lg p-3 focus:ring-2 focus:ring-orange-500"
                  >
                    <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                    {excretionOptions.skinCondition.map((condition, index) => (
                      <option key={index} value={condition}>{condition}</option>
                    ))}
                  </select>
                </div>
                <div>
                  <label htmlFor="excretion-free-text">æ’æ³„è‡ªç”±è¨˜è¿°</label>
                  <textarea
                    id="excretion-free-text"
                    name="excretionFreeText"
                    value={formData.excretionFreeText}
                    onChange={(e) => handleInputChange('excretionFreeText', e.target.value)}
                    aria-label="æ’æ³„ã®æ§˜å­ã«ã¤ã„ã¦è‡ªç”±ã«è¨˜éŒ²ã—ã¦ãã ã•ã„"
                    title="æ’æ³„ã®æ§˜å­ã«ã¤ã„ã¦è‡ªç”±ã«è¨˜éŒ²ã—ã¦ãã ã•ã„"
                    placeholder="æ’æ³„ã®æ§˜å­ã«ã¤ã„ã¦ã€è‡ªç”±ã«è¨˜éŒ²ã—ã¦ãã ã•ã„..."
                    className="w-full border rounded-lg p-3 h-24 focus:ring-2 focus:ring-orange-500"
                  />
                </div>
              </div>
            </div>

            {/* ç¡çœ è¨˜éŒ² (é­‚ã®ä¼‘æ¯) */}
            <div className="card bg-white shadow-lg rounded-xl p-6">
              <h2 className="text-xl font-bold mb-4 text-indigo-600">ğŸ˜´ ç¡çœ è¨˜éŒ² (é­‚ã®ä¼‘æ¯)</h2>
              <div className="space-y-4">
                <div>
                  <label htmlFor="sleep-time-input">æ™‚é–“</label>
                  <input
                    id="sleep-time-input"
                    name="sleepTime"
                    type="time"
                    aria-label="ç¡çœ ã®æ™‚é–“ã‚’é¸æŠã—ã¦ãã ã•ã„"
                    title="ç¡çœ ã®æ™‚é–“ã‚’é¸æŠã—ã¦ãã ã•ã„"
                    className="w-full border rounded-lg p-3 focus:ring-2 focus:ring-indigo-500"
                  />
                </div>
                <div>
                  <label className="block font-semibold text-gray-700 mb-2">å…¥çœ ã®æ§˜å­</label>
                  <div className="grid grid-cols-2 md:grid-cols-3 gap-2">
                    {sleepTags.fallingAsleep.map((option, index) => (
                      <label key={index} className="flex items-center p-2 border rounded hover:bg-indigo-50" htmlFor={`sleep-falling-checkbox-${index}`}>
                        <input
                          id={`sleep-falling-checkbox-${index}`}
                          name="sleepFalling"
                          type="checkbox"
                          checked={formData.sleepFalling.includes(option)}
                          onChange={(e) => handleArrayChange('sleepFalling', option, e.target.checked)}
                          className="mr-2"
                          aria-label={`å…¥çœ ã®æ§˜å­: ${option}`}
                        />
                        <span className="text-sm">{option}</span>
                      </label>
                    ))}
                  </div>
                </div>
                <div>
                  <label className="block font-semibold text-gray-700 mb-2">ç¡çœ ä¸­ã®æ§˜å­</label>
                  <div className="grid grid-cols-2 md:grid-cols-3 gap-2">
                    {sleepTags.duringSleep.map((option, index) => (
                      <label key={index} className="flex items-center p-2 border rounded hover:bg-indigo-50" htmlFor={`sleep-during-checkbox-${index}`}>
                        <input
                          id={`sleep-during-checkbox-${index}`}
                          name="sleepDuring"
                          type="checkbox"
                          checked={formData.sleepDuring.includes(option)}
                          onChange={(e) => handleArrayChange('sleepDuring', option, e.target.checked)}
                          className="mr-2"
                          aria-label={`ç¡çœ ä¸­ã®æ§˜å­: ${option}`}
                        />
                        <span className="text-sm">{option}</span>
                      </label>
                    ))}
                  </div>
                </div>
                <div>
                  <label htmlFor="sleep-free-text">ç¡çœ è‡ªç”±è¨˜è¿°</label>
                  <textarea
                    id="sleep-free-text"
                    name="sleepFreeText"
                    value={formData.sleepFreeText}
                    onChange={(e) => handleInputChange('sleepFreeText', e.target.value)}
                    aria-label="ç¡çœ ã®æ§˜å­ã«ã¤ã„ã¦è‡ªç”±ã«è¨˜éŒ²ã—ã¦ãã ã•ã„"
                    title="ç¡çœ ã®æ§˜å­ã«ã¤ã„ã¦è‡ªç”±ã«è¨˜éŒ²ã—ã¦ãã ã•ã„"
                    placeholder="ç¡çœ ã®æ§˜å­ã«ã¤ã„ã¦ã€è‡ªç”±ã«è¨˜éŒ²ã—ã¦ãã ã•ã„..."
                    className="w-full border rounded-lg p-3 h-24 focus:ring-2 focus:ring-indigo-500"
                  />
                </div>
              </div>
            </div>

            {/* ç™ºä½œè¨˜éŒ² */}
            <div className="card bg-white shadow-lg rounded-xl p-6">
              <div className="flex items-center justify-between mb-6">
                <h2 className="text-2xl font-bold text-red-600 flex items-center">
                  <span className="text-2xl mr-2">âš¡</span>
                  ç™ºä½œè¨˜éŒ²
                  <span className="text-sm text-gray-500 ml-2">(é­‚ã®è­¦é˜)</span>
                </h2>
                <div className="flex space-x-2">
                  <button
                    onClick={() => setIsViewingSeizureRecords(!isViewingSeizureRecords)}
                    className="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors flex items-center"
                  >
                    <Eye className="w-4 h-4 mr-2" />
                    {isViewingSeizureRecords ? 'ãƒ•ã‚©ãƒ¼ãƒ è¡¨ç¤º' : 'è¨˜éŒ²ä¸€è¦§'}
                  </button>
                </div>
              </div>

              {!isViewingSeizureRecords ? (
                <div className="space-y-4">
                  <div>
                    <label htmlFor="seizure-time-input">æ™‚é–“</label>
                    <input
                      id="seizure-time-input"
                      name="seizureTime"
                      type="time"
                      aria-label="ç™ºä½œã®æ™‚é–“ã‚’é¸æŠã—ã¦ãã ã•ã„"
                      title="ç™ºä½œã®æ™‚é–“ã‚’é¸æŠã—ã¦ãã ã•ã„"
                      className="w-full border rounded-lg p-3 focus:ring-2 focus:ring-red-500"
                    />
                  </div>
                  <div>
                    <label htmlFor="seizure-type-select" className="block font-semibold text-gray-700 mb-2">ç™ºä½œã®ç¨®é¡</label>
                    <div className="relative">
                      <select
                        id="seizure-type-select"
                        name="seizureType"
                        aria-label="ç™ºä½œã®ç¨®é¡ã‚’é¸æŠ"
                        value={typeof formData.seizureType === 'string' ? formData.seizureType : ''}
                        onChange={(e) => handleInputChange('seizureType', e.target.value)}
                        onFocus={() => setShowSeizureExplanation(formData.seizureType)}
                        className="w-full border rounded-lg p-3 focus:ring-2 focus:ring-red-500"
                      >
                        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                        {seizureOptions.map((option, index) => (
                          <option key={index} value={option}>{option}</option>
                        ))}
                      </select>
                      {showSeizureExplanation && formData.seizureType && (
                        <div className="absolute z-10 mt-2 p-3 bg-blue-50 border border-blue-200 rounded-lg shadow-lg max-w-md">
                          <h4 className="font-semibold text-blue-800 mb-1">{formData.seizureType}</h4>
                          <p className="text-sm text-blue-700">{seizureExplanations[formData.seizureType as keyof typeof seizureExplanations]}</p>
                          <button
                            onClick={() => setShowSeizureExplanation(null)}
                            className="mt-2 text-xs text-blue-600 hover:text-blue-800"
                          >
                            é–‰ã˜ã‚‹
                          </button>
                        </div>
                      )}
                    </div>
                  </div>
                  <div>
                    <label className="block font-semibold text-gray-700 mb-2">è¦‹ãŸã¾ã¾ã®ç¾è±¡</label>
                    <div className="grid grid-cols-2 md:grid-cols-3 gap-2">
                      {seizurePhenomenonOptions.map((phenomenon, index) => (
                        <label key={index} className="flex items-center p-2 border rounded hover:bg-red-50" htmlFor={`phenomenon-checkbox-${index}`}>
                          <input
                            id={`phenomenon-checkbox-${index}`}
                            name="seizurePhenomenon"
                            type="checkbox"
                            checked={formData.seizurePhenomenon.includes(phenomenon)}
                            onChange={(e) => handleArrayChange('seizurePhenomenon', phenomenon, e.target.checked)}
                            className="mr-2"
                            aria-label={`ç¾è±¡: ${phenomenon}`}
                          />
                          <span className="text-sm">{phenomenon}</span>
                        </label>
                      ))}
                    </div>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                      <label htmlFor="seizure-start-time" className="block font-semibold text-gray-700 mb-2">ç™ºä½œé–‹å§‹æ™‚åˆ»</label>
                      <input
                        id="seizure-start-time"
                        type="time"
                        value={formData.seizureStartTime}
                        onChange={(e) => handleInputChange('seizureStartTime', e.target.value)}
                        className="w-full border rounded-lg p-3 focus:ring-2 focus:ring-red-500"
                        aria-label="ç™ºä½œé–‹å§‹æ™‚åˆ»ã‚’å…¥åŠ›"
                        title="ç™ºä½œé–‹å§‹æ™‚åˆ»ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"
                      />
                    </div>
                    <div>
                      <label htmlFor="seizure-end-time" className="block font-semibold text-gray-700 mb-2">ç™ºä½œçµ‚äº†æ™‚åˆ»</label>
                      <input
                        id="seizure-end-time"
                        type="time"
                        value={formData.seizureEndTime}
                        onChange={(e) => handleInputChange('seizureEndTime', e.target.value)}
                        className="w-full border rounded-lg p-3 focus:ring-2 focus:ring-red-500"
                        aria-label="ç™ºä½œçµ‚äº†æ™‚åˆ»ã‚’å…¥åŠ›"
                        title="ç™ºä½œçµ‚äº†æ™‚åˆ»ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"
                      />
                    </div>
                  </div>
                  <div className="flex gap-4 items-center">
                    <button
                      type="button"
                      onClick={startSeizureTimer}
                      disabled={seizureTimer.isRunning}
                      className="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 disabled:bg-gray-400 transition-colors"
                    >
                      ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹
                    </button>
                    <button
                      type="button"
                      onClick={stopSeizureTimer}
                      disabled={!seizureTimer.isRunning}
                      className="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 disabled:bg-gray-400 transition-colors"
                    >
                      ã‚¿ã‚¤ãƒãƒ¼åœæ­¢
                    </button>
                    <span className="text-lg font-mono bg-gray-100 px-4 py-2 rounded">
                      {seizureTimer.duration}
                    </span>
                  </div>
                  <div>
                    <label htmlFor="seizure-template-select" className="block font-semibold text-gray-700 mb-2">ç™ºä½œè¨˜éŒ²ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</label>
                    <select
                      id="seizure-template-select"
                      name="seizureTemplate"
                      aria-label="ç™ºä½œè¨˜éŒ²ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠ"
                      value={typeof formData.seizureTemplate === 'string' ? formData.seizureTemplate : ''}
                      onChange={(e) => handleInputChange('seizureTemplate', e.target.value)}
                      className="w-full border rounded-lg p-3 focus:ring-2 focus:ring-red-500"
                    >
                      <option value="">ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„</option>
                      {seizureTemplates.map((template, index) => (
                        <option key={index} value={template}>{template}</option>
                      ))}
                    </select>
                  </div>
                  <div>
                    <label htmlFor="seizure-free-text" className="block font-semibold text-gray-700 mb-2">ç™ºä½œè‡ªç”±è¨˜è¿°</label>
                    <textarea
                      id="seizure-free-text"
                      name="seizureFreeText"
                      aria-label="ç™ºä½œã®æ§˜å­ã«ã¤ã„ã¦è‡ªç”±ã«è¨˜éŒ²ã—ã¦ãã ã•ã„"
                      value={formData.seizureFreeText}
                      onChange={(e) => handleInputChange('seizureFreeText', e.target.value)}
                      placeholder="ç™ºä½œã®æ§˜å­ã«ã¤ã„ã¦ã€è©³ç´°ã«è¨˜éŒ²ã—ã¦ãã ã•ã„..."
                      className="w-full border rounded-lg p-3 h-24 focus:ring-2 focus:ring-red-500"
                    />
                  </div>
                  <div className="flex justify-end space-x-4">
                    {editingSeizureRecord ? (
                      <>
                        <button
                          onClick={() => setEditingSeizureRecord(null)}
                          className="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition-colors"
                        >
                          ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                        </button>
                        <button
                          onClick={updateSeizureRecord}
                          className="bg-red-500 text-white px-6 py-2 rounded-lg hover:bg-red-600 transition-colors flex items-center"
                        >
                          <CheckCircle className="w-4 h-4 mr-2" />
                          æ›´æ–°
                        </button>
                      </>
                    ) : (
                      <button
                        onClick={saveSeizureRecord}
                        className="bg-red-500 text-white px-6 py-2 rounded-lg hover:bg-red-600 transition-colors flex items-center"
                      >
                        <Save className="w-4 h-4 mr-2" />
                        ç™ºä½œè¨˜éŒ²ã‚’ä¿å­˜
                      </button>
                    )}
                  </div>
                </div>
              ) : (
                <div>
                  <h3 className="text-lg font-semibold mb-4">ä¿å­˜ã•ã‚ŒãŸç™ºä½œè¨˜éŒ²</h3>
                  {savedSeizureRecords.length === 0 ? (
                    <p className="text-gray-500">ä¿å­˜ã•ã‚ŒãŸç™ºä½œè¨˜éŒ²ã¯ã‚ã‚Šã¾ã›ã‚“</p>
                  ) : (
                    <div className="space-y-4">
                      {savedSeizureRecords.map((record) => (
                        <div key={record.id} className="border rounded-lg p-4 bg-gray-50">
                          <div className="flex justify-between items-start mb-2">
                            <h4 className="font-semibold">{record.seizureType}</h4>
                            <div className="flex space-x-2">
                              <button
                                onClick={() => editSeizureRecord(record)}
                                className="text-blue-600 hover:text-blue-800"
                              >
                                <Edit className="w-4 h-4" />
                              </button>
                              <button
                                onClick={() => deleteSeizureRecord(record.id)}
                                className="text-red-600 hover:tex